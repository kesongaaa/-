<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Web Hand Gesture Interaction</title>

<style>
body {
  margin: 0;
  background: #0b0f14;
  overflow: hidden;
  font-family: sans-serif;
  color: white;
}

video {
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 220px;
  border-radius: 12px;
  opacity: 0.85;
}

#cursor {
  position: fixed;
  width: 18px;
  height: 18px;
  background: #00ffd5;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

#box {
  position: absolute;
  left: 40%;
  top: 40%;
  width: 200px;
  height: 120px;
  background: rgba(0,255,213,0.15);
  border: 2px solid #00ffd5;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}

#hoverBtn {
  position: absolute;
  top: 70%;
  left: 45%;
  padding: 20px 40px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
}
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<div id="cursor"></div>
<div id="box">ğŸ¤ æ‹–æˆ‘ / ç¼©æ”¾æˆ‘</div>
<button id="hoverBtn">âœ‹ æ‚¬åœ 2 ç§’</button>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById("video");
const cursor = document.getElementById("cursor");
const box = document.getElementById("box");
const hoverBtn = document.getElementById("hoverBtn");

let pinch = false;
let lastX = 0, lastY = 0;
let lastPinchDist = 0;
let hoverStart = null;
let bgToggle = false;

// æ‘„åƒå¤´
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => video.srcObject = stream);

// MediaPipe Hands
const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(res => {
  if (!res.multiHandLandmarks) return;

  const lm = res.multiHandLandmarks[0];
  const index = lm[8];
  const thumb = lm[4];
  const palm = lm[0];

  const x = index.x * window.innerWidth;
  const y = index.y * window.innerHeight;

  // å…‰æ ‡
  cursor.style.left = x + "px";
  cursor.style.top = y + "px";

  // æåˆ
  const pinchDist = Math.hypot(index.x - thumb.x, index.y - thumb.y);

  if (pinchDist < 0.04) {
    if (!pinch) {
      pinch = true;
      lastX = x;
      lastY = y;
      lastPinchDist = pinchDist;
    }

    // æ‹–æ‹½
    box.style.left = box.offsetLeft + (x - lastX) + "px";
    box.style.top = box.offsetTop + (y - lastY) + "px";

    // ç¼©æ”¾
    const scale = Math.max(0.5, 1 + (lastPinchDist - pinchDist) * 6);
    box.style.transform = `scale(${scale})`;

    lastX = x;
    lastY = y;
    lastPinchDist = pinchDist;
  } else {
    pinch = false;
  }

  // æ‚¬åœè§¦å‘
  const r = hoverBtn.getBoundingClientRect();
  if (x > r.left && x < r.right && y > r.top && y < r.bottom) {
    if (!hoverStart) hoverStart = Date.now();
    if (Date.now() - hoverStart > 2000) {
      hoverBtn.innerText = "âœ… å·²è§¦å‘";
      hoverBtn.style.background = "#00ffd5";
    }
  } else {
    hoverStart = null;
  }

  // å·¦å³æŒ¥æ‰‹åˆ‡æ¢èƒŒæ™¯
  if (palm.x < 0.1) {
    document.body.style.background = "#111";
  }
  if (palm.x > 0.9) {
    document.body.style.background = "#0b0f14";
  }
});

const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});
camera.start();
</script>

</body>
</html>
